# Copy this file to `.env` and fill values.
# Do not commit real credentials.

# -------------------------
# Broker / account
# -------------------------
BROKER=projectx
BROKER_BASE_URL=https://api.topstepx.com
BROKER_USERNAME=YOUR_USERNAME
BROKER_API_KEY=YOUR_API_KEY
ACCOUNT_ID=12345678
BROKER_USER_HUB_URL=https://rtc.topstepx.com/hubs/user
BROKER_MARKET_HUB_URL=https://rtc.topstepx.com/hubs/market

# -------------------------
# Runtime safety
# -------------------------
BOT_ENABLED=0
TRADING_ENVIRONMENT=DEMO
LIVE=false
FLATTEN_ON_START=false
TRADE_ON_START=false
EXIT_GRACE_SEC=5

# -------------------------
# Execution defaults
# -------------------------
SYMBOL=MNQ
SIDE=0
SIZE=1
SL_TICKS=40
TP_TICKS=80
LOOP_SEC=1

# -------------------------
# Strategy selection defaults
# -------------------------
STRAT_ENTRY_MODE=tick
STRAT_REQUIRE_ORDERFLOW=false
STRAT_FORWARD_BAR_SEC=60
STRAT_TICK_POLL_IDLE_SEC=0.25
STRAT_TICK_POLL_ARMED_SEC=0.05
STRAT_DEPTH_WARNING_COOLDOWN_SEC=30
SUB_DEPTH=true
RUNTIME_PROFILE=normal
TELEMETRY_DIR=artifacts/telemetry
TELEMETRY_CANDIDATES_FILE=candidate_trades.jsonl
TELEMETRY_PERF_FILE=performance.jsonl
DEBUG_TICK_TRACE_EVERY_N=20

# -------------------------
# NY session structure parameters
# -------------------------
STRAT_NY_SESSION_START=09:30
STRAT_NY_SESSION_END=16:00
STRAT_TZ_NAME=America/New_York
STRAT_HTF_AGGREGATION=15
STRAT_BIAS_AGGREGATION=60
STRAT_HTF_SWING_HIGH=5
STRAT_HTF_SWING_LOW=5
STRAT_LTF_SWING_HIGH=3
STRAT_LTF_SWING_LOW=3
STRAT_SWEEP_WICK_MIN=0.5
STRAT_SWEEP_EXPIRY_BARS=40
STRAT_EQUAL_LEVEL_TOL_BPS=8
STRAT_KEY_AREA_TOL_BPS=12
STRAT_MIN_CONFLUENCE=1
STRAT_TICK_SETUP_EXPIRY_BARS=3
STRAT_TICK_HISTORY_SIZE=120
STRAT_TICK_MIN_IMBALANCE=0.12
STRAT_TICK_MIN_TRADE_SIZE=1.0
STRAT_TICK_SPOOF_COLLAPSE=0.35
STRAT_TICK_ABSORPTION_TRADES=2
STRAT_TICK_ICEBERG_RELOADS=2

# -------------------------
# ML gate
# -------------------------
STRAT_ML_GATE_ENABLED=false
STRAT_ML_DECISION_POLICY=off
STRAT_ML_MODEL_PATH=artifacts/models/xgboost_model.json
STRAT_ML_MIN_PROBA=0.55
STRAT_ML_FAIL_OPEN=false

# -------------------------
# Position management (SL/TP/sizing)
# -------------------------
# Split drawdown controls:
# - STRAT_ACCOUNT_MAX_DRAWDOWN: per-trade sizing budget anchor.
# - ACCOUNT_MAX_DRAWDOWN_KILLSWITCH: runtime/backtest stop-trading threshold.
STRAT_ACCOUNT_MAX_DRAWDOWN=2000
ACCOUNT_MAX_DRAWDOWN_KILLSWITCH=2000

# Backward-compat fallback (used only if split vars above are missing).
ACCOUNT_MAX_DRAWDOWN=2000

STRAT_MAX_TRADE_DRAWDOWN_FRACTION=0.15
STRAT_MIN_RRR=3.0
STRAT_MAX_RRR=10.0
STRAT_SL_NOISE_BUFFER_TICKS=2
STRAT_SL_MAX_TICKS=200
STRAT_TP_FRONT_RUN_TICKS=2
STRAT_ML_MIN_SIZE_FRACTION=0.35
STRAT_ML_SIZE_FLOOR_SCORE=0.55
STRAT_ML_SIZE_CEILING_SCORE=0.90
STRAT_ENABLE_EXHAUSTION_MARKET_EXIT=true
STRAT_DRAWDOWN_GUARD_ENABLED=true
STRAT_MAX_OPEN_POSITIONS=1
STRAT_MAX_OPEN_ORDERS_WHILE_FLAT=0

# Optional symbol-specific overrides.
# If omitted, defaults come from SYMBOL profile in code (MNQ/NQ/MES/ES/MGC/GC).
# STRAT_TICK_SIZE=0.25
# STRAT_TICK_VALUE=0.5
# STRAT_DOM_LIQUIDITY_WALL_SIZE=800

# -------------------------
# Optional backtest/train defaults
# -------------------------
BACKTEST_DATA_PARQUET=data/parquet/mbp10
BACKTEST_INITIAL_CASH=10000
BACKTEST_FEE_PER_ORDER=1.0
BACKTEST_SLIPPAGE_BPS=1.0
BACKTEST_SLIP_ENTRY_TICKS=0.0
BACKTEST_SLIP_STOP_TICKS=0.0
BACKTEST_SLIP_TP_TICKS=0.0
BACKTEST_SPREAD_SLIP_K=1.0
BACKTEST_ENTRY_DELAY_EVENTS=1
BACKTEST_CANDIDATE_MONTHS=0
BACKTEST_WALK_FORWARD=false
BACKTEST_WF_WINDOW_MONTHS=6
BACKTEST_WF_STEP_MONTHS=1
BACKTEST_ORDERFLOW_SESSION_ONLY=true
# BACKTEST_WF_START_UTC=2025-01-01T00:00:00Z
# BACKTEST_WF_END_UTC=2026-01-01T00:00:00Z
BACKTEST_CANDIDATES_PARQUET=artifacts/telemetry/backtest_candidates.parquet
BACKTEST_MATRIX_PARQUET=artifacts/telemetry/backtest_candidate_matrix.parquet
BACKTEST_SUMMARY_PARQUET=artifacts/telemetry/backtest_summary.parquet
BACKTEST_BAR_SEC=60
# Optional fast-test cap; loads only the first N rows when >0.
BACKTEST_MAX_ROWS=0
BACKTEST_HEALTH_STRICT=false
BACKTEST_HEALTH_MIN_CANDIDATES=1
BACKTEST_HEALTH_MIN_TRADES=1
BACKTEST_HEALTH_MAX_DRAWDOWN_PCT=50
BACKTEST_SHADOW_ML_ENABLED=false
BACKTEST_SHADOW_ML_MODEL_PATH=artifacts/models/xgboost_model.json
BACKTEST_SHADOW_ML_MIN_PROBA=0.55
BACKTEST_PREFLIGHT_STRICT=true
BACKTEST_PREFLIGHT_REQUIRE_SEQ=true
BACKTEST_PREFLIGHT_MIN_ROWS=1
BACKTEST_PREFLIGHT_MIN_QUOTE_COVERAGE=0.90
BACKTEST_PREFLIGHT_MIN_DEPTH_COVERAGE=0.90
BACKTEST_PREFLIGHT_MIN_SESSION_ROWS=1
BACKTEST_SENSITIVITY_SWEEP=false
BACKTEST_SWEEP_ENTRY_DELAYS=0,1,2
BACKTEST_SWEEP_SLIP_ENTRY_TICKS=0,0.5,1.0
BACKTEST_SWEEP_SPREAD_SLIP_K=0,1,2

# Optional major-news blackout controls for backtests.
STRAT_AVOID_NEWS=false
STRAT_NEWS_EXIT_ON_EVENT=false
# BACKTEST_NEWS_PATH=data/news_usd_major.parquet
BACKTEST_NEWS_PRE_MIN=15
BACKTEST_NEWS_POST_MIN=15
BACKTEST_NEWS_MAJOR_ONLY=true
BACKTEST_NEWS_CURRENCIES=USD

# -------------------------
# Diagnostics
# -------------------------
DEBUG_HTTP=false
DEBUG_RTC=true
